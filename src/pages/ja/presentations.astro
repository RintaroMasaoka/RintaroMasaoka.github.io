---
import BaseLayout from '../../layouts/BaseLayout.astro';
import PublicationCard from '../../components/PublicationCard.astro';
import { useTranslations, localize } from '../../i18n/utils';
import { presentations as presData } from '../../utils/data';

const lang = 'ja';
const t = useTranslations(lang);

const categories = presData.categories;
const presentations = presData.presentations;

const groupedPresentations = categories.map((cat: any) => ({
  ...cat,
  label: localize(cat.label, lang),
  items: presentations.filter((pres: any) => pres.category === cat.id)
})).filter((cat: any) => cat.items.length > 0);
---

<BaseLayout title={t('page.presentations.title')} lang={lang}>
  <div class="mb-8">
    <h1 class="font-serif text-4xl font-bold text-primary-900 dark:text-primary-50 mb-2">{t('page.presentations.title')}</h1>
    <p class="text-primary-500 dark:text-primary-400">{t('page.presentations.description')}</p>
  </div>

  <!-- カテゴリナビゲーション -->
  <nav class="mb-8 sticky top-16 bg-primary-50/80 dark:bg-primary-900/80 backdrop-blur-sm py-3 -mx-6 px-6 border-b border-primary-100 dark:border-primary-700">
    <ul class="flex flex-wrap gap-2">
      {groupedPresentations.map((cat: any) => (
        <li>
          <a
            href={`#${cat.id}`}
            class="inline-block px-4 py-1.5 text-sm font-medium text-primary-600 dark:text-primary-300 bg-white dark:bg-primary-800 border border-primary-200 dark:border-primary-600 rounded-full hover:border-accent dark:hover:border-accent-light hover:text-accent dark:hover:text-accent-light transition-colors"
          >
            {cat.label}
            <span class="ml-1 text-xs text-primary-400 dark:text-primary-500">({cat.items.length})</span>
          </a>
        </li>
      ))}
    </ul>
  </nav>

  <!-- 発表リスト -->
  <div class="space-y-12">
    {groupedPresentations.map((cat: any) => (
      <section id={cat.id}>
        <h2 class="font-serif text-2xl font-semibold text-primary-900 dark:text-primary-50 mb-6 flex items-center gap-3">
          <span class="w-6 h-1 bg-accent rounded-full"></span>
          {cat.label}
        </h2>
        <div class="grid gap-4">
          {cat.items.map((pub: any) => (
            <PublicationCard
              title={pub.title}
              authors={pub.authors}
              year={pub.year}
              venue={pub.venue}
              links={pub.links}
              abstract={pub.abstract}
              icon={cat.id === 'talk' ? 'talk' : cat.id.startsWith('oral') ? 'oral' : cat.id.startsWith('poster') ? 'poster' : undefined}
            />
          ))}
        </div>
      </section>
    ))}
  </div>
</BaseLayout>
