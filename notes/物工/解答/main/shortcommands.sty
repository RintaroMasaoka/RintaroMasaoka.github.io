% by Rintaro Masaoka
% lastly updated: Feb 28, 2024

\RequirePackage{
   amsmath,
   mathtools,
   xparse,
   mathcommand,
   newunicodechar,
   unicode-math,
   diffcoeff
}
\DeclareOption{uprightconst}{\let\conststyle\symup} 
\DeclareOption{italicconst}{\let\conststyle\symit}
\ExecuteOptions{uprightconst}
\ProcessOptions\relax


% Math accents
\newcommand{\âˆ¼}{\tilde}
\newcommand{\ï¼¾}{\hat}
\newcommand{\ï¼¿}{\bar}
\newcommand{\â‹…}{\dot}
\newcommand{\â€}{\ddot}
\newcommand{\ï¼}{\not}
\newcommand{\âˆ¨}{\check}
\newcommand{\âˆª}{\breve}
\newcommand{\â†’}{\vec}
\newcommand{\â†}[1]{
   \mathrlap{\reflectbox{\ensuremath{\vec{\phantom{#1}}}}}#1
}
\newcommand{\â†”}[1]{
   \mathrlap{\reflectbox{\ensuremath{\vec{\phantom{#1}}}}}\vec{#1}
}
\newcommand{\â‹¯}{\dddot}

% constants
\newunicodechar{â„¯}{\conststyle{e}}
\newunicodechar{Â¡}{\conststyle{i}}
\newunicodechar{ğ˜¬}{k_{\symup{B}}}
\newunicodechar{Ä§}{\hbar}

% Short commands
\newcommand{\âˆš}[1]{\mathinner{\sqrt{#1}}}
\newunicodechar{âˆš}{\âˆš}
\newunicodechar{Ã·}{\frac}
\newcommand{\Ã·}{\div}
\newunicodechar{â¨¸}{\dfrac}
\newunicodechar{â£}{\quad}
\newunicodechar{ï¼¿}{_\mathup}
\newunicodechar{ï¼¾}{^\mathup}
\newcommand{\â£}{\qquad}
\newcommand{\âˆ…}{\nonumber \\}

% differential
\NewDocumentCommand{\ğš}{s e{^} t_ m}{
   \IfBooleanTF{#1}
   {\IfBooleanTF{#3}{\diff[#2]{}/{#4}}{\diff[#2]{#4}/}}
   {\IfBooleanTF{#3}{\diff[#2]{}{#4}}{\diff[#2]{#4}}}
}
\NewDocumentCommand{\âˆ‚}{s e{^} t_ m}{
   \IfBooleanTF{#1}
   {\IfBooleanTF{#3}{\diffp[#2]{}/{#4}}{\diffp[#2]{#4}/}}
   {\IfBooleanTF{#3}{\diffp[#2]{}{#4}}{\diffp[#2]{#4}}}
}
\NewDocumentCommand{\Î´}{s e{^} t_ m}{
   \IfBooleanTF{#1}
   {\IfBooleanTF{#3}{\diffd[#2]{}/{#4}}{\diffd[#2]{#4}/}}
   {\IfBooleanTF{#3}{\diffd[#2]{}{#4}}{\diffd[#2]{#4}}}
} 
\NewDocumentCommand{\Î”}{s e{^} t_ m}{
   \IfBooleanTF{#1}
   {\IfBooleanTF{#3}{\Diffd[#2]{}/{#4}}{\Diffd[#2]{#4}/}}
   {\IfBooleanTF{#3}{\Diffd[#2]{}{#4}}{\Diffd[#2]{#4}}}
}
\NewDocumentCommand{\ğ‘‘}{e{^} m}{
   \IfNoValueTF{#1}
   {\mathinner{\symup{d}#2}}
   {\mathinner{\symup{d}^{#1}#2}}
}
\newcommand{\ğ’Ÿ}[1]{\mathinner{ğ’Ÿ#1}}
\newcommand{\ğ›¥}[1]{\mathinner{Î”#1}}
\newcommand{\ğ›¿}[1]{\mathinner{Î´#1}}

% brakets
\newcommand{\âŸ¨}{\left\langle}
\newcommand{\âŸ©}{\right\rangle}
\newcommand{\âˆ£}{~\middle|~}
\newcommand{\ï¼ˆ}{\left\lparen\begin{matrix}}
\newcommand{\ï¼‰}{\end{matrix}\right\rparen}
\newcommand{\ï¼»}{\left\lbrack\begin{matrix}}
\newcommand{\ï¼½}{\end{matrix}\right\rbrack}
\newcommand{\ï½›}{\left\lbrace\begin{matrix}}
\newcommand{\ï½}{\end{matrix}\right\rbrace}
\newunicodechar{ï¼ˆ}{\left\lparen}
\newunicodechar{ï¼‰}{\right\rparen}
\newunicodechar{ï¼»}{\left\lbrack}
\newunicodechar{ï¼½}{\right\rbrack}
\newunicodechar{ï½›}{\left\lbrace}
\newunicodechar{ï½}{\right\rbrace}
\newunicodechar{ï½Ÿ}{\left\lparen\begin{matrix}}
\newunicodechar{ï½ }{\end{matrix}\right\rparen}
\newunicodechar{ã€š}{\left\lbrack\begin{matrix}}
\newunicodechar{ã€›}{\end{matrix}\right\rbrack}
\newunicodechar{ï½œ}{\Big|}

% other commands
\newcommand{\ğš›}{\right}
\newcommand{\ğš•}{\left}
\newcommand{\ğš–}{\middle}
\newcommand{\ğš}{\text}
\newcommand{\ğš}{\mathup}
\NewDocumentCommand{\ğšš}{s m}{
   \IfBooleanTF{#1}{}{\quad}\text{#2}\quad
}
\newcommand{\ğ™´}{\left.\vphantom{\int}\right\rvert}
\newcommand{\ğ™¼}[1]{\begin{matrix}#1\end{matrix}}

% Math operators
\let\abs\relax
\DeclareMathOperator{\abs}{abs}
\let\tr\relax
\DeclareMathOperator{\tr}{tr}
\let\Tr\relax
\DeclareMathOperator{\Tr}{Tr}
\DeclareMathOperator{\sgn}{sgn}
\DeclareMathOperator{\sign}{sign}
\DeclareMathOperator{\ad}{ad}
\DeclareMathOperator{\Ad}{Ad}
\DeclareMathOperator{\End}{End}
\DeclareMathOperator{\Det}{Det}
\DeclareMathOperator{\Pf}{Pf}
\DeclareMathOperator{\pf}{pf}
\DeclareMathOperator{\haf}{haf}
\DeclareMathOperator{\diag}{diag}
\DeclareMathOperator{\Ker}{Ker}
\DeclareMathOperator{\coker}{coker}
\DeclareMathOperator{\im}{im}
\DeclareMathOperator{\coim}{coim}
\DeclareMathOperator{\Span}{Span}
\DeclareMathOperator{\Spec}{Spec}
\DeclareMathOperator{\Hom}{Hom}
\newcommand{\id}{\mathup{id}}
\newcommand{\Phys}{\mathup{Phys}}
\newcommand{\gnd}{\mathup{gnd}}
\newcommand{\Gnd}{\mathup{Gnd}}
\newcommand{\reg}{\mathup{reg.}}
\newcommand{\hc}{\mathup{h.c.}}
\newcommand{\cc}{\mathup{c.c.}}
\newcommand{\const}{\mathup{const.}}
\newcommand{\SO}{\mathup{SO}}
\newcommand{\SU}{\mathup{SU}}
\newcommand{\GL}{\mathup{GL}}
\newcommand{\SL}{\mathup{SL}}
\newcommand{\so}{\mathfrak{so}}
\newcommand{\su}{\mathfrak{su}}
\newcommand{\gl}{\mathfrak{gl}}
\renewcommand{\sl}{\mathfrak{sl}}
\newcommand{\Spin}{\mathup{Spin}}
\def\O{\symup{O}}
\def\U{\symup{U}}
\AtBeginDocument{
    \let\Re\relax \DeclareMathOperator\Re{\mathrm{Re}}%
    \let\Im\relax \DeclareMathOperator\Im{\mathrm{Im}}%
}

% redefinition of some unicode characters
\newunicodechar{â˜…}{\star}
\newunicodechar{âˆ…}{\emptyset}
\newunicodechar{â‹¯}{\mathinner{\cdots}}
\newunicodechar{â€¦}{\mathinner{\ldots}}
\newunicodechar{â‰Ÿ}{\overset{?}{=}}
\newunicodechar{âˆ£}{\mid}
% \newunicodechar{â†‘}{{\uparrow}}
% \newunicodechar{â†“}{{\downarrow}}

\newunicodechar{ğ‘}{{\symup{a}}}
\newunicodechar{ğ‘}{{\symup{b}}}
\newunicodechar{ğ‘}{{\symup{c}}}
\newunicodechar{ğ‘‘}{{\symup{d}}}
\newunicodechar{ğ‘’}{{\symup{e}}}
\newunicodechar{ğ‘“}{{\symup{f}}}
\newunicodechar{ğ‘”}{{\symup{g}}}
\newunicodechar{â„}{{\symup{h}}}
\newunicodechar{ğ‘–}{{\symup{i}}}
\newunicodechar{ğ‘—}{{\symup{j}}}
\newunicodechar{ğ‘˜}{{\symup{k}}}
\newunicodechar{ğ‘™}{{\symup{l}}}
\newunicodechar{ğ‘š}{{\symup{m}}}
\newunicodechar{ğ‘›}{{\symup{n}}}
\newunicodechar{ğ‘œ}{{\symup{o}}}
\newunicodechar{ğ‘}{{\symup{p}}}
\newunicodechar{ğ‘}{{\symup{q}}}
\newunicodechar{ğ‘Ÿ}{{\symup{r}}}
\newunicodechar{ğ‘ }{{\symup{s}}}
\newunicodechar{ğ‘¡}{{\symup{t}}}
\newunicodechar{ğ‘¢}{{\symup{u}}}
\newunicodechar{ğ‘£}{{\symup{v}}}
\newunicodechar{ğ‘¤}{{\symup{w}}}
\newunicodechar{ğ‘¥}{{\symup{x}}}
\newunicodechar{ğ‘¦}{{\symup{y}}}
\newunicodechar{ğ‘§}{{\symup{z}}}

\newunicodechar{ğ´}{{\symup{A}}}
\newunicodechar{ğµ}{{\symup{B}}}
\newunicodechar{ğ¶}{{\symup{C}}}
\newunicodechar{ğ·}{{\symup{D}}}
\newunicodechar{ğ¸}{{\symup{E}}}
\newunicodechar{ğ¹}{{\symup{F}}}
\newunicodechar{ğº}{{\symup{G}}}
\newunicodechar{ğ»}{{\symup{H}}}
\newunicodechar{ğ¼}{{\symup{I}}}
\newunicodechar{ğ½}{{\symup{J}}}
\newunicodechar{ğ¾}{{\symup{K}}}
\newunicodechar{ğ¿}{{\symup{L}}}
\newunicodechar{ğ‘€}{{\symup{M}}}
\newunicodechar{ğ‘}{{\symup{N}}}
\newunicodechar{ğ‘‚}{{\symup{O}}}
\newunicodechar{ğ‘ƒ}{{\symup{P}}}
\newunicodechar{ğ‘„}{{\symup{Q}}}
\newunicodechar{ğ‘…}{{\symup{R}}}
\newunicodechar{ğ‘†}{{\symup{S}}}
\newunicodechar{ğ‘‡}{{\symup{T}}}
\newunicodechar{ğ‘ˆ}{{\symup{U}}}
\newunicodechar{ğ‘‰}{{\symup{V}}}
\newunicodechar{ğ‘Š}{{\symup{W}}}
\newunicodechar{ğ‘‹}{{\symup{X}}}
\newunicodechar{ğ‘Œ}{{\symup{Y}}}
\newunicodechar{ğ‘}{{\symup{Z}}}

\newunicodechar{ğ›¼}{{\symup{\alpha}}}
\newunicodechar{ğ›½}{{\symup{\beta}}}
\newunicodechar{ğ›¾}{{\symup{\gamma}}}
\newunicodechar{ğ›¿}{\symup{\delta}}
\newunicodechar{ğœ–}{{\symup{\epsilon}}}
\newunicodechar{ğœ‚}{{\symup{\eta}}}
\newunicodechar{ğœ‹}{{\symup{\pi}}}
\newunicodechar{ğœ‰}{{\symup{\xi}}}
\newunicodechar{ğœˆ}{\symup{\nu}}
\newunicodechar{ğœ€}{{\symup{\varepsilon}}}
\newunicodechar{ğ›¥}{\symup{\Delta}}